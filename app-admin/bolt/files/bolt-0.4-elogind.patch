--- a/meson.build	2018-06-04 22:20:54.995774099 -0500
+++ b/meson.build	2018-06-04 22:17:09.163268661 -0500
@@ -76,8 +76,16 @@
 unix    = dependency('gio-unix-2.0')
 udev    = dependency('udev')
 polkit  = dependency('polkit-gobject-1')
-systemd = dependency('systemd')
-libsysd = dependency('libsystemd')
+
+enable_elogind = get_option('elogind')
+
+if enable_elogind
+  systemd = dependency('libelogind')
+  libsysd = dependency('libelogind')
+else
+  systemd = dependency('systemd')
+  libsysd = dependency('libsystemd')
+endif
 
 git     = find_program('git', required: false)
 a2x     = find_program(['a2x', 'a2x.py'], required: req_man)
@@ -95,7 +102,12 @@
 
 dbdir = get_option('db-path')
 udevdir = udev.get_pkgconfig_variable('udevdir')
-unitdir = systemd.get_pkgconfig_variable('systemdsystemunitdir')
+
+if enable_elogind
+  unitdir = ''
+else
+  unitdir = systemd.get_pkgconfig_variable('systemdsystemunitdir')
+endif
 
 version_split = meson.project_version().split('.')
 version_major = version_split[0]
@@ -113,6 +124,10 @@
 
 conf.set('_GNU_SOURCE', true)
 
+if enable_elogind
+  conf.set('HAVE_ELOGIND', enable_elogind)
+endif
+
 foreach fn : [
   ['explicit_bzero', '''#include <string.h>'''],
   ['getrandom',      '''#include <sys/random.h>''']


--- a/meson_options.txt	2018-05-28 07:10:53.000000000 -0500
+++ b/meson_options.txt	2018-06-04 22:13:53.988520038 -0500
@@ -1,3 +1,4 @@
 option('db-path', type: 'string', value: '/var/lib/boltd', description: 'Directory for the device database')
 option('man', type: 'combo', choices: ['auto', 'true', 'false'], value: 'auto', description: 'Build man pages')
 option('privileged-group', type: 'string', value: 'wheel', description: 'Name of privileged group')
+option('elogind', type: 'boolean', value: false, description: 'Use elogind')


--- a/boltd/bolt-daemon.c	2018-05-28 07:10:53.000000000 -0500
+++ b/boltd/bolt-daemon.c	2018-06-04 22:18:21.979421784 -0500
@@ -28,7 +28,11 @@
 
 #include "bolt-daemon-resource.h"
 
+#ifdef HAVE_ELOGIND
+#include <elogind/sd-id128.h>
+#else
 #include <systemd/sd-id128.h>
+#endif
 
 #include <gio/gio.h>
 
